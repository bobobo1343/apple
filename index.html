<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>iTunes Style Music Player</title>
<style>
  /* Reset */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    margin: 0; padding: 0;
    background: #fff;
    color: #000;
    user-select: none;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }
  body.dark {
    background: #121212;
    color: #ddd;
  }

  #app {
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  header {
    background: #f5f5f7;
    padding: 10px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid #ccc;
  }
  body.dark header {
    background: #1e1e1e;
    border-color: #333;
  }
  header h1 {
    margin: 0;
    font-weight: 600;
    font-size: 1.3rem;
  }

  .dark-toggle {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-size: 0.9rem;
  }
  .dark-toggle input {
    margin-right: 8px;
    cursor: pointer;
  }

  main {
    flex: 1;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    background: #fafafa;
  }
  body.dark main {
    background: #181818;
  }

  #search-bar {
    padding: 10px 20px;
    border-bottom: 1px solid #ccc;
  }
  body.dark #search-bar {
    border-color: #333;
  }
  #search-input {
    width: 100%;
    font-size: 1rem;
    padding: 6px 10px;
    border: 1px solid #aaa;
    border-radius: 4px;
  }
  body.dark #search-input {
    background: #222;
    color: #ddd;
    border-color: #555;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
    font-size: 0.95rem;
  }
  thead {
    background: #e0e0e0;
  }
  body.dark thead {
    background: #292929;
  }
  th, td {
    padding: 10px 8px;
    text-align: left;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  th.sortable {
    cursor: pointer;
    user-select: none;
    position: relative;
  }
  th.sortable::after {
    content: "‚ñæ";
    font-size: 0.7rem;
    color: #888;
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    opacity: 0.3;
  }
  th.sortable.asc::after {
    content: "‚ñ¥";
    opacity: 0.7;
  }
  th.sortable.desc::after {
    content: "‚ñæ";
    opacity: 0.7;
  }
  tbody tr {
    cursor: pointer;
    border-bottom: 1px solid #ddd;
  }
  body.dark tbody tr {
    border-color: #333;
  }
  tbody tr:hover {
    background: #d0d0d0;
  }
  body.dark tbody tr:hover {
    background: #2a2a2a;
  }
  tbody tr.playing {
    background: #b4d0ff;
  }
  body.dark tbody tr.playing {
    background: #3355bb;
  }

  footer.player-controls {
    padding: 10px 20px;
    border-top: 1px solid #ccc;
    background: #f5f5f7;
    display: flex;
    flex-direction: column;
    user-select: none;
  }
  body.dark footer.player-controls {
    background: #1e1e1e;
    border-color: #333;
  }
  .player-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
  }
  .now-playing {
    font-weight: 600;
  }
  .now-playing .artist {
    margin-left: 6px;
    font-weight: 400;
    color: #666;
  }
  body.dark .now-playing .artist {
    color: #aaa;
  }

  .buttons {
    display: flex;
    gap: 10px;
  }
  .control-btn {
    background: none;
    border: none;
    font-size: 1.3rem;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 4px;
    transition: background 0.15s ease;
  }
  .control-btn:hover, .control-btn:focus {
    background: #ddd;
    outline: none;
  }
  body.dark .control-btn:hover, body.dark .control-btn:focus {
    background: #444;
  }
  .control-btn.active {
    color: #0066ff;
  }

  .progress-container {
    width: 100%;
    height: 8px;
    background: #ddd;
    border-radius: 4px;
    cursor: pointer;
    position: relative;
  }
  body.dark .progress-container {
    background: #333;
  }
  .progress-filled {
    height: 100%;
    background: #0066ff;
    width: 0%;
    border-radius: 4px;
    transition: width 0.1s linear;
  }

  .time {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: #444;
    margin-top: 4px;
  }
  body.dark .time {
    color: #aaa;
  }

  .volume-container {
    margin-top: 10px;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.9rem;
  }
  #volume-slider {
    flex-grow: 1;
  }

  /* Scrollbar for table */
  tbody {
    display: block;
    overflow-y: auto;
    max-height: calc(100vh - 260px);
  }
  thead, tbody tr {
    display: table;
    width: 100%;
    table-layout: fixed;
  }

</style>
</head>
<body>
<div id="app" role="application" aria-label="iTunes style music player">

<header>
  <h1>iTunes Music Player</h1>
  <label class="dark-toggle" for="dark-mode-checkbox">
    <input type="checkbox" id="dark-mode-checkbox" aria-label="Toggle dark mode" />
    Dark Mode
  </label>
</header>

<main>
  <section id="search-bar">
    <input type="search" id="search-input" placeholder="Search music..." aria-label="Search music"/>
  </section>
  <section id="tracklist-container" aria-live="polite" aria-atomic="true">
    <table id="tracklist" role="grid" aria-label="Track list">
      <thead>
        <tr>
          <th scope="col" class="sortable" data-key="title" tabindex="0" aria-sort="ascending">Title</th>
          <th scope="col" class="sortable" data-key="artist" tabindex="0" aria-sort="none">Artist</th>
          <th scope="col" class="sortable" data-key="album" tabindex="0" aria-sort="none">Album</th>
          <th scope="col" style="text-align:right;" class="sortable" data-key="duration" tabindex="0" aria-sort="none">Duration</th>
          <th scope="col" style="text-align:center;" class="sortable" data-key="genre" tabindex="0" aria-sort="none">Genre</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>
</main>

<footer class="player-controls" role="region" aria-label="Player controls">
  <div class="player-top">
    <div class="now-playing" aria-live="polite" aria-atomic="true">
      <span id="np-title">-</span><span class="artist" id="np-artist"></span>
    </div>
    <div class="buttons">
      <button class="control-btn" id="btn-prev" title="Previous Track" aria-label="Previous Track">‚èÆÔ∏è</button>
      <button class="control-btn" id="btn-playpause" title="Play/Pause" aria-label="Play or Pause">‚ñ∂Ô∏è</button>
      <button class="control-btn" id="btn-next" title="Next Track" aria-label="Next Track">‚è≠Ô∏è</button>
      <button class="control-btn" id="btn-shuffle" title="Toggle Shuffle" aria-label="Shuffle">üîÄ</button>
      <button class="control-btn" id="btn-repeat" title="Toggle Repeat" aria-label="Repeat">üîÅ</button>
    </div>
  </div>
  <div class="progress-container" id="progress-bar" role="slider" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" tabindex="0" aria-label="Playback progress">
    <div class="progress-filled" id="progress-filled"></div>
  </div>
  <div class="time">
    <span id="time-current">0:00</span>
    <span id="time-duration">0:00</span>
  </div>
  <div class="volume-container">
    <label for="volume-slider">Volume</label>
    <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.7" aria-label="Volume control"/>
  </div>
</footer>
</div>

<script>
(() => {
  "use strict";

  // Sample playlist with CORS-enabled mp3 URLs (replace with your own)
  const tracks = [
    {
      title: "Acoustic Breeze",
      artist: "Benjamin Tissot",
      album: "Calm",
      genre: "Acoustic",
      duration: "2:37",
      url: "https://www.bensound.com/bensound-music/bensound-acousticbreeze.mp3"
    },
    {
      title: "Sunny",
      artist: "Benjamin Tissot",
      album: "Happy",
      genre: "Pop",
      duration: "2:20",
      url: "https://www.bensound.com/bensound-music/bensound-sunny.mp3"
    },
    {
      title: "Energy",
      artist: "Benjamin Tissot",
      album: "Vibes",
      genre: "Electronic",
      duration: "2:56",
      url: "https://www.bensound.com/bensound-music/bensound-energy.mp3"
    }
  ];

  const tracklistBody = document.querySelector("#tracklist tbody");
  const npTitle = document.getElementById("np-title");
  const npArtist = document.getElementById("np-artist");
  const btnPlayPause = document.getElementById("btn-playpause");
  const btnNext = document.getElementById("btn-next");
  const btnPrev = document.getElementById("btn-prev");
  const btnShuffle = document.getElementById("btn-shuffle");
  const btnRepeat = document.getElementById("btn-repeat");
  const progressBar = document.getElementById("progress-bar");
  const progressFilled = document.getElementById("progress-filled");
  const timeCurrent = document.getElementById("time-current");
  const timeDuration = document.getElementById("time-duration");
  const volumeSlider = document.getElementById("volume-slider");
  const searchInput = document.getElementById("search-input");
  const darkModeCheckbox = document.getElementById("dark-mode-checkbox");

  let filteredTracks = [...tracks];
  let currentTrackIndex = -1;
  let isPlaying = false;
  let shuffle = false;
  let repeat = false;
  let currentSortKey = "title";
  let currentSortOrder = "asc";

  const audio = new Audio();
  audio.crossOrigin = "anonymous";

  // Load dark mode preference
  if(localStorage.getItem("darkMode") === "true") {
    document.body.classList.add("dark");
    darkModeCheckbox.checked = true;
  }
  darkModeCheckbox.addEventListener("change", () => {
    if(darkModeCheckbox.checked) {
      document.body.classList.add("dark");
      localStorage.setItem("darkMode", "true");
    } else {
      document.body.classList.remove("dark");
      localStorage.setItem("darkMode", "false");
    }
  });

  function updateSortHeaders() {
    document.querySelectorAll("#tracklist thead th.sortable").forEach(th => {
      th.classList.remove("asc","desc");
      th.setAttribute("aria-sort", "none");
      if(th.dataset.key === currentSortKey){
        th.classList.add(currentSortOrder);
        th.setAttribute("aria-sort", currentSortOrder==="asc"?"ascending":"descending");
      }
    });
  }

  function formatTime(seconds) {
    if(isNaN(seconds)) return "0:00";
    const m = Math.floor(seconds/60);
    const s = Math.floor(seconds%60);
    return m+":"+s.toString().padStart(2,"0");
  }

  function sortAndRender() {
    filteredTracks.sort((a,b) => {
      let va = a[currentSortKey] || "";
      let vb = b[currentSortKey] || "";

      if(currentSortKey === "duration"){
        // convert mm:ss to seconds for sorting
        const toSeconds = str => {
          const parts = str.split(":");
          if(parts.length!==2) return 0;
          return parseInt(parts[0],10)*60 + parseInt(parts[1],10);
        };
        va = toSeconds(va);
        vb = toSeconds(vb);
      } else {
        va = va.toString().toLowerCase();
        vb = vb.toString().toLowerCase();
      }
      if(va < vb) return currentSortOrder === "asc" ? -1 : 1;
      if(va > vb) return currentSortOrder === "asc" ? 1 : -1;
      return 0;
    });
    renderTrackList();
    updateSortHeaders();
  }

  function renderTrackList(){
    tracklistBody.innerHTML = "";
    filteredTracks.forEach((track,i) => {
      const tr = document.createElement("tr");
      tr.tabIndex = 0;
      if(i===currentTrackIndex) tr.classList.add("playing");
      tr.dataset.index = i;
      tr.innerHTML = `
        <td title="${track.title}">${track.title}</td>
        <td title="${track.artist}">${track.artist}</td>
        <td title="${track.album}">${track.album}</td>
        <td style="text-align:right;">${track.duration}</td>
        <td style="text-align:center;">${track.genre}</td>
      `;
      tracklistBody.appendChild(tr);
    });
  }

  function playTrack(index) {
    if(index < 0 || index >= filteredTracks.length) return;
    const track = filteredTracks[index];
    currentTrackIndex = index;
    renderTrackList();

    audio.src = track.url;
    audio.play().catch(err => {
      console.error("Play error:", err);
      alert(`Playback failed: ${err.message}`);
    });
    isPlaying = true;
    btnPlayPause.textContent = "‚è∏Ô∏è";
    npTitle.textContent = track.title || "-";
    npArtist.textContent = track.artist ? ` ‚Äî ${track.artist}` : "";
  }

  function playNext() {
    if(shuffle){
      let randIndex;
      do {
        randIndex = Math.floor(Math.random()*filteredTracks.length);
      } while(randIndex === currentTrackIndex && filteredTracks.length > 1);
      playTrack(randIndex);
      return;
    }
    if(currentTrackIndex + 1 < filteredTracks.length) {
      playTrack(currentTrackIndex + 1);
    } else {
      if(repeat) {
        playTrack(0);
      } else {
        audio.pause();
        isPlaying = false;
        btnPlayPause.textContent = "‚ñ∂Ô∏è";
      }
    }
  }

  function playPrev() {
    if(currentTrackIndex > 0) {
      playTrack(currentTrackIndex - 1);
    } else {
      if(repeat) {
        playTrack(filteredTracks.length -1);
      } else {
        audio.currentTime = 0;
      }
    }
  }

  function togglePlayPause() {
    if(!audio.src && filteredTracks.length > 0){
      playTrack(0);
      return;
    }
    if(isPlaying) {
      audio.pause();
      isPlaying = false;
      btnPlayPause.textContent = "‚ñ∂Ô∏è";
    } else {
      audio.play().catch(() => {});
      isPlaying = true;
      btnPlayPause.textContent = "‚è∏Ô∏è";
    }
  }

  audio.addEventListener("timeupdate", () => {
    if(!audio.duration) return;
    const percent = (audio.currentTime / audio.duration) * 100;
    progressFilled.style.width = percent + "%";
    progressBar.setAttribute("aria-valuenow", Math.floor(percent));
    timeCurrent.textContent = formatTime(audio.currentTime);
    timeDuration.textContent = formatTime(audio.duration);
  });

  audio.addEventListener("ended", () => {
    playNext();
  });

  progressBar.addEventListener("click", e => {
    const rect = progressBar.getBoundingClientRect();
    const clickX = e.clientX - rect.left;
    const percent = clickX / rect.width;
    if(audio.duration) {
      audio.currentTime = percent * audio.duration;
    }
  });

  volumeSlider.addEventListener("input", () => {
    audio.volume = volumeSlider.value;
  });

  btnPlayPause.addEventListener("click", togglePlayPause);
  btnNext.addEventListener("click", playNext);
  btnPrev.addEventListener("click", playPrev);
  btnShuffle.addEventListener("click", () => {
    shuffle = !shuffle;
    btnShuffle.classList.toggle("active", shuffle);
  });
  btnRepeat.addEventListener("click", () => {
    repeat = !repeat;
    btnRepeat.classList.toggle("active", repeat);
  });

  tracklistBody.addEventListener("click", e => {
    let tr = e.target.closest("tr");
    if(tr) {
      const idx = parseInt(tr.dataset.index, 10);
      if(!isNaN(idx)) {
        playTrack(idx);
      }
    }
  });

  // Keyboard navigation for track list
  tracklistBody.addEventListener("keydown", e => {
    let tr = e.target.closest("tr");
    if(!tr) return;
    let idx = parseInt(tr.dataset.index, 10);
    if(isNaN(idx)) return;
    if(e.key === "Enter" || e.key === " ") {
      playTrack(idx);
      e.preventDefault();
    } else if(e.key === "ArrowDown") {
      e.preventDefault();
      let next = tr.nextElementSibling || tracklistBody.firstElementChild;
      next.focus();
    } else if(e.key === "ArrowUp") {
      e.preventDefault();
      let prev = tr.previousElementSibling || tracklistBody.lastElementChild;
      prev.focus();
    }
  });

  // Search filter
  searchInput.addEventListener("input", () => {
    const term = searchInput.value.trim().toLowerCase();
    filteredTracks = tracks.filter(t => 
      t.title.toLowerCase().includes(term) ||
      t.artist.toLowerCase().includes(term) ||
      t.album.toLowerCase().includes(term) ||
      t.genre.toLowerCase().includes(term)
    );
    sortAndRender();
  });

  // Sorting columns
  document.querySelectorAll("#tracklist thead th.sortable").forEach(th => {
    th.addEventListener("click", () => {
      const key = th.dataset.key;
      if(currentSortKey === key){
        currentSortOrder = currentSortOrder === "asc" ? "desc" : "asc";
      } else {
        currentSortKey = key;
        currentSortOrder = "asc";
      }
      sortAndRender();
    });
    th.addEventListener("keydown", e => {
      if(e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        th.click();
      }
    });
  });

  // Initial render
  sortAndRender();
})();

</script>
</body>
</html>
